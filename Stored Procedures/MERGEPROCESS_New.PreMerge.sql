SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [MERGEPROCESS_New].[PreMerge]
	AS 
Declare @LogDate datetime = (Select getdate())

INSERT INTO MERGEPROCESS_New.LogPreMergeAccount
Select a.FK_MergeID,ObjectType, 'Winner' MergeRecordType, @LogDate LogDate, 
b.Id,
b.IsDeleted,
b.MasterRecordId,
b.Name,
b.Type,
b.ParentId,
b.BillingStreet,
b.BillingCity,
b.BillingState,
b.BillingPostalCode,
b.BillingCountry,
b.BillingLatitude,
b.BillingLongitude,
b.BillingAddress,
b.ShippingStreet,
b.ShippingCity,
b.ShippingState,
b.ShippingPostalCode,
b.ShippingCountry,
b.ShippingLatitude,
b.ShippingLongitude,
b.ShippingAddress,
b.Phone,
b.Website,
b.PhotoUrl,
b.Industry,
b.NumberOfEmployees,
b.Description,
b.OwnerId,
b.CreatedDate,
b.CreatedById,
b.LastModifiedDate,
b.LastModifiedById,
b.SystemModstamp,
b.LastActivityDate,
b.LastViewedDate,
b.LastReferencedDate,
b.JigsawCompanyId,
b.Fax,
b.AnnualRevenue,
b.AccountSource,
b.SicDesc,
b.RecordTypeId,
b.Jigsaw,
b.AccountNumber,
b.Sic,
b.Ownership,
b.TickerSymbol,
b.Rating,
b.Site,
b.hed__Current_Address__c,
b.hed__Primary_Contact__c,
b.SSB_CRMSYSTEM_ACCT_ID__c,
b.SSB_CRMSYSTEM_CY_Donation_Amount__c,
b.SSB_CRMSYSTEM_CY_Donation_Level__c,
b.SSB_CRMSYSTEM_CY_Donation_Upsell__c,
b.SSB_CRMSYSTEM_Donor_Warning__c,
b.SSB_CRMSYSTEM_Football_STH__c,
b.SSB_CRMSYSTEM_Football_Partial__c,
b.SSB_CRMSYSTEM_Football_Rookie__c,
b.SSB_CRMSYSTEM_Last_Donation_Date__c,
b.SSB_CRMSYSTEM_Last_Ticket_Purchase_Date__c,
b.SSB_CRMSYSTEM_Mens_Basketball_STH__c,
b.SSB_CRMSYSTEM_Mens_Basketball_Partial__c,
b.SSB_CRMSYSTEM_Mens_Basketball_Rookie__c,
b.SSB_CRMSYSTEM_SSID_Winner__c,
b.SSB_CRMSYSTEM_DimCustomerID__c,
b.SSB_CRMSYSTEM_TM_Account_ID__c,
b.SSB_CRMSYSTEM_SSID_TM__c,
b.SSB_CRMSYSTEM_Total_Priority_Points__c,
b.copyloaddate,
b.SSB_CRMSYSTEM_Consecutive_Years__c,
b.SSB_CRMSYSTEM_Millenium_ID__c,
b.SSB_CRMSYSTEM_Phone_Home__c,
b.SSB_CRMSYSTEM_Phone_Cell__c,
b.SSB_CRMSYSTEM_CLA_CC1116_ConcertProspect__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Premium_Buyer__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Group_Buyer__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Total_Spend__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Suite_Prospect__c
FROM MERGEPROCESS_New.Queue a
JOIN mergeprocess_new.tmp_pcaccount b
	ON a.Winning_ID = b.ID
UNION ALL
Select a.FK_MergeID,ObjectType, 'Loser' MergeRecordType, @LogDate LogDate, 
b.Id,
b.IsDeleted,
b.MasterRecordId,
b.Name,
b.Type,
b.ParentId,
b.BillingStreet,
b.BillingCity,
b.BillingState,
b.BillingPostalCode,
b.BillingCountry,
b.BillingLatitude,
b.BillingLongitude,
b.BillingAddress,
b.ShippingStreet,
b.ShippingCity,
b.ShippingState,
b.ShippingPostalCode,
b.ShippingCountry,
b.ShippingLatitude,
b.ShippingLongitude,
b.ShippingAddress,
b.Phone,
b.Website,
b.PhotoUrl,
b.Industry,
b.NumberOfEmployees,
b.Description,
b.OwnerId,
b.CreatedDate,
b.CreatedById,
b.LastModifiedDate,
b.LastModifiedById,
b.SystemModstamp,
b.LastActivityDate,
b.LastViewedDate,
b.LastReferencedDate,
b.JigsawCompanyId,
b.Fax,
b.AnnualRevenue,
b.AccountSource,
b.SicDesc,
b.RecordTypeId,
b.Jigsaw,
b.AccountNumber,
b.Sic,
b.Ownership,
b.TickerSymbol,
b.Rating,
b.Site,
b.hed__Current_Address__c,
b.hed__Primary_Contact__c,
b.SSB_CRMSYSTEM_ACCT_ID__c,
b.SSB_CRMSYSTEM_CY_Donation_Amount__c,
b.SSB_CRMSYSTEM_CY_Donation_Level__c,
b.SSB_CRMSYSTEM_CY_Donation_Upsell__c,
b.SSB_CRMSYSTEM_Donor_Warning__c,
b.SSB_CRMSYSTEM_Football_STH__c,
b.SSB_CRMSYSTEM_Football_Partial__c,
b.SSB_CRMSYSTEM_Football_Rookie__c,
b.SSB_CRMSYSTEM_Last_Donation_Date__c,
b.SSB_CRMSYSTEM_Last_Ticket_Purchase_Date__c,
b.SSB_CRMSYSTEM_Mens_Basketball_STH__c,
b.SSB_CRMSYSTEM_Mens_Basketball_Partial__c,
b.SSB_CRMSYSTEM_Mens_Basketball_Rookie__c,
b.SSB_CRMSYSTEM_SSID_Winner__c,
b.SSB_CRMSYSTEM_DimCustomerID__c,
b.SSB_CRMSYSTEM_TM_Account_ID__c,
b.SSB_CRMSYSTEM_SSID_TM__c,
b.SSB_CRMSYSTEM_Total_Priority_Points__c,
b.copyloaddate,
b.SSB_CRMSYSTEM_Consecutive_Years__c,
b.SSB_CRMSYSTEM_Millenium_ID__c,
b.SSB_CRMSYSTEM_Phone_Home__c,
b.SSB_CRMSYSTEM_Phone_Cell__c,
b.SSB_CRMSYSTEM_CLA_CC1116_ConcertProspect__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Premium_Buyer__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Group_Buyer__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Total_Spend__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Suite_Prospect__c
FROM MERGEPROCESS_New.Queue a
JOIN mergeprocess_new.tmp_pcaccount b
	ON a.Losing_ID = b.ID

INSERT INTO MERGEPROCESS_New.LogPreMergeContact
Select a.FK_MergeID,ObjectType, 'Winner' MergeRecordType, @LogDate LogDate, 
b.Id,
b.IsDeleted,
b.MasterRecordId,
b.Name,
b.Phone,
b.PhotoUrl,
b.OwnerId,
b.CreatedDate,
b.CreatedById,
b.LastModifiedDate,
b.LastModifiedById,
b.SystemModstamp,
b.LastActivityDate,
b.LastViewedDate,
b.LastReferencedDate,
b.SSB_CRMSYSTEM_ACCT_ID__c,
b.SSB_CRMSYSTEM_SSID_Winner__c,
b.AccountId,
b.LastName,
b.FirstName,
b.Salutation,
b.Suffix,
b.OtherStreet,
b.OtherCity,
b.OtherState,
b.OtherPostalCode,
b.OtherCountry,
b.OtherLatitude,
b.OtherLongitude,
b.OtherAddress,
b.MailingStreet,
b.MailingCity,
b.MailingState,
b.MailingPostalCode,
b.MailingCountry,
b.MailingLatitude,
b.MailingLongitude,
b.MailingAddress,
b.Fax,
b.MobilePhone,
b.HomePhone,
b.OtherPhone,
b.ReportsToId,
b.Email,
b.Title,
b.Department,
b.Birthdate,
b.LastCURequestDate,
b.LastCUUpdateDate,
b.EmailBouncedReason,
b.EmailBouncedDate,
b.IsEmailBounced,
b.JigsawContactId,
b.Gender__c,
b.SSB_CRMSYSTEM_CONTACT_ID__c,
b.AssistantPhone,
b.AssistantName,
b.LeadSource,
b.Description,
b.HasOptedOutOfEmail,
b.DoNotCall,
b.Jigsaw,
b.HasOptedOutOfFax,
b.SSB_CRMSYSTEM_Last_Ticket_Purchase_Date__c,
b.SSB_CRMSYSTEM_Last_Donation_Date__c,
b.SSB_CRMSYSTEM_Donor_Warning__c,
b.SSB_CRMSYSTEM_Total_Priority_Points__c,
b.SSB_CRMSYSTEM_Football_STH__c,
b.SSB_CRMSYSTEM_Football_Rookie__c,
b.SSB_CRMSYSTEM_Football_Partial__c,
b.SSB_CRMSYSTEM_Mens_Basketball_STH__c,
b.SSB_CRMSYSTEM_Mens_Basketball_Rookie__c,
b.SSB_CRMSYSTEM_Mens_Basketball_Partial__c,
b.SSB_CRMSYSTEM_CY_Donation_Level__c,
b.SSB_CRMSYSTEM_CY_Donation_Amount__c,
b.SSB_CRMSYSTEM_CY_Donation_Upsell__c,
b.SSB_CRMSYSTEM_SSID_TM__c,
b.SSB_CRMSYSTEM_DimCustomerID__c,
b.SSB_CRMSYSTEM_TM_Account_ID__c,
b.hed__AlternateEmail__c,
b.hed__Citizenship__c,
b.hed__Country_of_Origin__c,
b.hed__Current_Address__c,
b.hed__Deceased__c,
b.hed__Do_Not_Contact__c,
b.hed__Ethnicity__c,
b.hed__Exclude_from_Household_Formal_Greeting__c,
b.hed__Exclude_from_Household_Informal_Greeting__c,
b.hed__Exclude_from_Household_Name__c,
b.hed__FERPA__c,
b.hed__Financial_Aid_Applicant__c,
b.hed__Gender__c,
b.hed__HIPAA_Detail__c,
b.hed__HIPAA__c,
b.hed__Military_Background__c,
b.hed__Military_Service__c,
b.hed__Naming_Exclusions__c,
b.hed__PreferredPhone__c,
b.hed__Preferred_Email__c,
b.hed__Primary_Address_Type__c,
b.hed__Primary_Household__c,
b.hed__Primary_Organization__c,
b.hed__Religion__c,
b.hed__Secondary_Address_Type__c,
b.hed__Social_Security_Number__c,
b.hed__UniversityEmail__c,
b.hed__WorkEmail__c,
b.hed__WorkPhone__c,
b.hed__Work_Address__c,
b.hed__is_Address_Override__c,
b.SSB_CRMSYSTEM_CorporateBuyer_Flag__c,
b.SSB_CRMSYSTEM_Company_Name__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Group_Buyer__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Premium_Buyer__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Total_Spend__c,
b.copyloaddate,
b.SSB_CRMSYSTEM_CLA_CC11_16_Suite_Prospect__c,
b.SSB_CRMSYSTEM_Consecutive_Years__c,
b.SSB_CRMSYSTEM_Millenium_ID__c,
b.SSB_CRMSYSTEM_CLA_CC1116_ConcertProspect__c
FROM MERGEPROCESS_New.Queue a
JOIN mergeprocess_new.tmp_pccontact b
	ON a.Winning_ID = b.ID
UNION ALL
Select a.FK_MergeID,ObjectType, 'Loser' MergeRecordType, @LogDate LogDate, 
b.Id,
b.IsDeleted,
b.MasterRecordId,
b.Name,
b.Phone,
b.PhotoUrl,
b.OwnerId,
b.CreatedDate,
b.CreatedById,
b.LastModifiedDate,
b.LastModifiedById,
b.SystemModstamp,
b.LastActivityDate,
b.LastViewedDate,
b.LastReferencedDate,
b.SSB_CRMSYSTEM_ACCT_ID__c,
b.SSB_CRMSYSTEM_SSID_Winner__c,
b.AccountId,
b.LastName,
b.FirstName,
b.Salutation,
b.Suffix,
b.OtherStreet,
b.OtherCity,
b.OtherState,
b.OtherPostalCode,
b.OtherCountry,
b.OtherLatitude,
b.OtherLongitude,
b.OtherAddress,
b.MailingStreet,
b.MailingCity,
b.MailingState,
b.MailingPostalCode,
b.MailingCountry,
b.MailingLatitude,
b.MailingLongitude,
b.MailingAddress,
b.Fax,
b.MobilePhone,
b.HomePhone,
b.OtherPhone,
b.ReportsToId,
b.Email,
b.Title,
b.Department,
b.Birthdate,
b.LastCURequestDate,
b.LastCUUpdateDate,
b.EmailBouncedReason,
b.EmailBouncedDate,
b.IsEmailBounced,
b.JigsawContactId,
b.Gender__c,
b.SSB_CRMSYSTEM_CONTACT_ID__c,
b.AssistantPhone,
b.AssistantName,
b.LeadSource,
b.Description,
b.HasOptedOutOfEmail,
b.DoNotCall,
b.Jigsaw,
b.HasOptedOutOfFax,
b.SSB_CRMSYSTEM_Last_Ticket_Purchase_Date__c,
b.SSB_CRMSYSTEM_Last_Donation_Date__c,
b.SSB_CRMSYSTEM_Donor_Warning__c,
b.SSB_CRMSYSTEM_Total_Priority_Points__c,
b.SSB_CRMSYSTEM_Football_STH__c,
b.SSB_CRMSYSTEM_Football_Rookie__c,
b.SSB_CRMSYSTEM_Football_Partial__c,
b.SSB_CRMSYSTEM_Mens_Basketball_STH__c,
b.SSB_CRMSYSTEM_Mens_Basketball_Rookie__c,
b.SSB_CRMSYSTEM_Mens_Basketball_Partial__c,
b.SSB_CRMSYSTEM_CY_Donation_Level__c,
b.SSB_CRMSYSTEM_CY_Donation_Amount__c,
b.SSB_CRMSYSTEM_CY_Donation_Upsell__c,
b.SSB_CRMSYSTEM_SSID_TM__c,
b.SSB_CRMSYSTEM_DimCustomerID__c,
b.SSB_CRMSYSTEM_TM_Account_ID__c,
b.hed__AlternateEmail__c,
b.hed__Citizenship__c,
b.hed__Country_of_Origin__c,
b.hed__Current_Address__c,
b.hed__Deceased__c,
b.hed__Do_Not_Contact__c,
b.hed__Ethnicity__c,
b.hed__Exclude_from_Household_Formal_Greeting__c,
b.hed__Exclude_from_Household_Informal_Greeting__c,
b.hed__Exclude_from_Household_Name__c,
b.hed__FERPA__c,
b.hed__Financial_Aid_Applicant__c,
b.hed__Gender__c,
b.hed__HIPAA_Detail__c,
b.hed__HIPAA__c,
b.hed__Military_Background__c,
b.hed__Military_Service__c,
b.hed__Naming_Exclusions__c,
b.hed__PreferredPhone__c,
b.hed__Preferred_Email__c,
b.hed__Primary_Address_Type__c,
b.hed__Primary_Household__c,
b.hed__Primary_Organization__c,
b.hed__Religion__c,
b.hed__Secondary_Address_Type__c,
b.hed__Social_Security_Number__c,
b.hed__UniversityEmail__c,
b.hed__WorkEmail__c,
b.hed__WorkPhone__c,
b.hed__Work_Address__c,
b.hed__is_Address_Override__c,
b.SSB_CRMSYSTEM_CorporateBuyer_Flag__c,
b.SSB_CRMSYSTEM_Company_Name__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Group_Buyer__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Premium_Buyer__c,
b.SSB_CRMSYSTEM_CLA_CC11_16_Total_Spend__c,
b.copyloaddate,
b.SSB_CRMSYSTEM_CLA_CC11_16_Suite_Prospect__c,
b.SSB_CRMSYSTEM_Consecutive_Years__c,
b.SSB_CRMSYSTEM_Millenium_ID__c,
b.SSB_CRMSYSTEM_CLA_CC1116_ConcertProspect__c
FROM MERGEPROCESS_New.Queue a
JOIN mergeprocess_new.tmp_pccontact b
	ON a.Losing_ID = b.ID



GO
